<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />
		<title>Anytype</title>

		<script src="./js/jquery.js"></script>

		<style type="text/css">
			* { margin: 0px; padding: 0px; box-sizing: border-box; }
	
			@font-face {
				font-family: 'Inter'; font-style: normal; font-weight: 500;
				src: url('./font/inter/medium.woff2') format('woff2');
			}

			body { font-family: 'Inter', sans-serif; font-size: 14px; color: #000; background: transparent; }

			#tabs { display: flex; flex-direction: row; height: 28px; padding: 4px 12px 0px 12px; -webkit-app-region: drag; }
			#tabs.platform-darwin { padding-left: 76px; }

			.tab { 
				display: flex; align-items: center; justify-content: flex-start; gap: 0px 6px; background-color: #ebebeb; padding: 0px 2px 0px 8px; 
				cursor: default; flex-basis: 200px; user-select: none; -webkit-app-region: no-drag; border-radius: 6px 6px 0px 0px; overflow: hidden;
				flex: 1 1; max-width: 200px;
			}
			.tab.noClose { padding-right: 8px; }
			.tab.active { background-color: #f7f7f7; }
			.tab.isAdd { justify-content: center; font-size: 18px; font-weight: bold; flex-basis: 28px; padding: 0px 8px; flex-grow: 0; flex-shrink: 0; }

			.tab {
				.clickable { display: flex; align-items: center; gap: 0px 6px; flex-grow: 1; overflow: hidden; }
				.name { white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
				.image { width: 18px; height: 18px; object-fit: contain; flex-shrink: 0; }
				.icon.close { 
					width: 20px; height: 20px; background-size: contain; background-repeat: no-repeat; background-position: center; 
					background-image: url('./img/icon/close.svg'); flex-shrink: 0; border-radius: 6px; background-size: 16px;
				}
				.icon.close:hover { background-color: rgba(0, 0, 0, 0.05); }
			}
		</style>
	</head>
	<body>
		<div id="tabs"></div>

		<script type="text/javascript">
			$(document).ready(() => {
				const electron = window.Electron;
				const currentWindow = electron.currentWindow();
				const winId = Number(currentWindow?.windowId) || 0;
				const container = $('#tabs').addClass(`platform-${electron.platform}`);

				const setActive = (id) => {
					container.find('.tab.active').removeClass('active');
					container.find(`#tab-${id}`).addClass('active');
				};

				const setTabs = (tabs, id) => {
					container.empty();

					tabs = tabs || [];
					tabs.forEach((it, i) => {
						const data = it.data || {};
						const title = String(data.title || 'New tab');
						const icon = String(data.icon || '');

						const tab = $(`
							<div id="tab-${it.id}" class="tab">
								<div class="clickable">
									<div class="name">${title}</div>
								</div>	
								<div class="icon close"></div>
							</div>
						`);

						container.append(tab);

						const clickable = tab.find('.clickable');

						if (icon) {
							clickable.prepend($(`<img src="${icon}" class="image" />`));
						};

						if (tabs.length === 1) {
							tab.find('.icon.close').remove();
							tab.addClass('noClose');
						};

						clickable.off('click').on('click', () => {
							electron.Api(winId, 'setActiveTab', Number(i));
							setActive(i);
						});

						tab.find('.icon.close').off('click').on('click', (e) => {
							e.stopPropagation();
							electron.Api(winId, 'removeTab', [ it.id, true ]);
						});
					});

					const plus = $('<div class="tab isAdd"><div class="name">+</div></div>');			
					container.append(plus);

					plus.off('click').on('click', () => electron.Api(winId, 'createTab'));
			
					setActive(id);
				};

				electron.Api(winId, 'getTabs').then(({ tabs, id }) => setTabs(tabs, id));
				electron.on('update-tabs', (e, tabs, id) => setTabs(tabs, id));
			});
		</script>
	</body>
</html>